# npm-audit-to-report

[![build](https://github.com/egorsmkv/npm-audit-to-report/actions/workflows/build.yml/badge.svg)](https://github.com/egorsmkv/npm-audit-to-report/actions/workflows/build.yml)

A lightweight Rust CLI that converts newline-delimited `npm audit` or `yarn audit` JSON output into a polished Markdown report you can drop into issues, chat notifications, or release notes.

## Highlights
- Produces a readable Markdown summary with dependency counts, severity totals, and individual advisories.
- Writes to both `stdout` and a Markdown file (default `security-audit.md`) so you can review locally or archive in CI.
- Works with standard `npm audit --json` and `yarn audit --json` output without any post-processing.
- Optional `--fail-if-no-vulnerabilities` flag allows "only create an issue when problems exist" style workflows.

## Demo

Example output generated by the tool:

<img loading="lazy" alt="npm-audit-to-report demo" width="800px" src="https://github.com/egorsmkv/npm-audit-to-report/raw/main/demo.png" />

## Quick Start

1. Generate an audit file (newline-delimited JSON):
   ```bash
   # npm
   npm audit --json > security-audit.json

   # or Yarn classic / Yarn Berry
   yarn audit --json > security-audit.json
   ```
2. Run the converter (defaults shown):
   ```bash
   npm-audit-to-report \
     --audit-file security-audit.json \
     --output-file security-audit.md
   ```
3. Open `security-audit.md` or use the printed report directly from `stdout`.

Sample Markdown snippet:

```markdown
# Security Audit: 2024-05-15 09:31:07 (UTC)

## Vulnerabilities
- ðŸ”µ Info: 1
- ðŸŸ¢ Low: 0
- ðŸŸ¡ Moderate: 2
- ðŸŸ  High: 0
- ðŸ”´ Critical: 0
```

## Installation

Requires a Rust toolchain (Rust 1.75+ recommended).

```bash
cargo install --locked --git https://github.com/egorsmkv/npm-audit-to-report.git
```

You can also build a one-off binary via `cargo build --release` and copy `target/release/npm-audit-to-report` into your toolchain cache or CI workflow.

## CLI Reference

```text
Convert npm audit JSON lines into a Markdown summary.

Usage: npm-audit-to-report [OPTIONS]

Options:
  -i, --audit-file <AUDIT_FILE>     [default: security-audit.json]
  -o, --output-file <OUTPUT_FILE>   [default: security-audit.md]
  -f, --fail-if-no-vulnerabilities  return a non-zero exit code when no issues are found
  -h, --help                        Print help
  -V, --version                     Print version
```

The `--fail-if-no-vulnerabilities` flag is useful when you only want to create tickets or notifications when problems exist. Combine it with a `continue-on-error` step in CI so follow-up actions run only when the audit fails.

## CI Integration

Two ready-to-use GitHub Actions workflows live in this repository:

- [`dependency-audit.yml`](https://github.com/egorsmkv/npm-audit-to-report/blob/main/dependency-audit.yml) - always generates a report and opens a GitHub issue on every successful run.
- [`dependency-audit-only-when-detected.yml`](https://github.com/egorsmkv/npm-audit-to-report/blob/main/dependency-audit-only-when-detected.yml) - uses `--fail-if-no-vulnerabilities` and conditional steps so issues are created only when vulnerabilities are present.

Both workflows install dependencies, run `yarn audit --json`, build the CLI, and attach the generated Markdown as the issue body. Adapt them to your own project or CI provider.

## Development

```bash
just fmt   # cargo fmt
just lint  # cargo clippy --all-targets --all-features -- -D warnings
just test  # cargo test
```

### Release

```bash
cargo build --release
```
